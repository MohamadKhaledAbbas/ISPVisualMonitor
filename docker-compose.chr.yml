version: "3.8"

services:
  chr-core-01:
    image: evilfreelancer/docker-routeros:latest
    container_name: isp-chr-core-01
    hostname: chr-core-01
    ports:
      - "8728:8728"        # API
      - "8729:8729"        # API-SSL
      - "2221:22"          # SSH
      - "18081:80"         # WebFig
      - "161:161/udp"      # SNMP (optional)
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    networks:
      chr_network:
        ipv4_address: 172.25.0.10
    environment:
      - ROUTER_NAME=chr-core-01
      - ROUTER_ROLE=core_router
    restart: unless-stopped

  chr-edge-01:
    image: evilfreelancer/docker-routeros:latest
    container_name: isp-chr-edge-01
    hostname: chr-edge-01
    ports:
      - "8738:8728"        # API (host) -> 8728 (router)
      - "8739:8729"        # API-SSL
      - "2222:22"          # SSH
      - "18082:80"         # WebFig
      - "162:161/udp"      # SNMP (optional)
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    networks:
      chr_network:
        ipv4_address: 172.25.0.11
    environment:
      - ROUTER_NAME=chr-edge-01
      - ROUTER_ROLE=edge_router
    restart: unless-stopped

  chr-access-01:
    image: evilfreelancer/docker-routeros:latest
    container_name: isp-chr-access-01
    hostname: chr-access-01
    ports:
      - "8748:8728"        # API (host) -> 8728 (router)
      - "8749:8729"        # API-SSL
      - "2223:22"          # SSH
      - "18083:80"         # WebFig
      - "163:161/udp"      # SNMP (optional)
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    networks:
      chr_network:
        ipv4_address: 172.25.0.12
    environment:
      - ROUTER_NAME=chr-access-01
      - ROUTER_ROLE=access_router,nat_gateway
    restart: unless-stopped

  chr-pppoe-01:
    image: evilfreelancer/docker-routeros:latest
    container_name: isp-chr-pppoe-01
    hostname: chr-pppoe-01
    ports:
      - "8758:8728"        # API (host) -> 8728 (router)
      - "8759:8729"        # API-SSL
      - "2224:22"          # SSH
      - "18084:80"         # WebFig
      - "164:161/udp"      # SNMP (optional)
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    networks:
      chr_network:
        ipv4_address: 172.25.0.13
    environment:
      - ROUTER_NAME=chr-pppoe-01
      - ROUTER_ROLE=pppoe_server,dhcp_server
    restart: unless-stopped

networks:
  chr_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.25.0.0/16